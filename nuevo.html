<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Nuevo producto</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main>
    <div class="card">
      <div class="eyebrow">Inventario</div>
      <h1>Ingresar nuevo producto</h1>
      <p>Completa el formulario con la informacion del articulo.</p>
      <form class="form" action="#" method="post">
        <div class="field">
          <label for="nombre">Nombre</label>
          <input type="text" id="nombre" name="nombre" placeholder="Ej. Mermelada artesanal" required>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="precio">Precio</label>
            <input type="number" id="precio" name="precio" step="0.01" min="0" placeholder="0.00" required>
          </div>
          <div class="field">
            <label for="cantidad">Cantidad</label>
            <input type="number" id="cantidad" name="cantidad" min="0" placeholder="0" required>
          </div>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="categoria">Categoria</label>
            <input type="text" id="categoria" name="categoria" placeholder="Ej. Bebidas" required>
          </div>
          <div class="field">
            <label for="subcategoria">Subcategoria</label>
            <input type="text" id="subcategoria" name="subcategoria" placeholder="Ej. Jugos naturales">
          </div>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="elaboracion">Fecha de elaboracion</label>
            <input type="date" id="elaboracion" name="elaboracion">
          </div>
          <div class="field">
            <label for="vencimiento">Fecha de vencimiento</label>
            <input type="date" id="vencimiento" name="vencimiento">
          </div>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="empaque">Empaque</label>
            <input type="text" id="empaque" name="empaque" placeholder="Ej. Botella de vidrio">
          </div>
          <div class="field">
            <label for="presentacion">Presentacion</label>
            <input type="text" id="presentacion" name="presentacion" placeholder="Ej. 500 ml">
          </div>
        </div>
        <div class="field">
          <label for="ingredientes">Ingredientes</label>
          <textarea id="ingredientes" name="ingredientes" rows="3" placeholder="Lista de ingredientes"></textarea>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="canton">Canton de origen</label>
            <input type="text" id="canton" name="canton" placeholder="Ej. Cuenca">
          </div>
          <div class="field">
            <label for="provincia">Provincia de origen</label>
            <input type="text" id="provincia" name="provincia" placeholder="Ej. Azuay">
          </div>
        </div>
        <div class="actions">
          <a class="button secondary" href="index.html">Volver</a>
          <button class="button" type="submit">Guardar producto</button>
        </div>
        <div class="status" id="formStatus" role="status" aria-live="polite"></div>
      </form>
    </div>
  </main>
  <script>
    const form = document.querySelector('.form');
    const status = document.getElementById('formStatus');
    const submitBtn = form.querySelector('button[type="submit"]');

    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      status.textContent = 'Guardando producto...';
      status.className = 'status';
      submitBtn.disabled = true;

      const data = Object.fromEntries(new FormData(form).entries());
      data.precio = data.precio ? Number(data.precio) : null;
      data.cantidad = data.cantidad ? Number(data.cantidad) : null;

      try {
        const response = await fetch('/api/productos', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (!response.ok) {
          const err = await response.json().catch(() => ({}));
          throw new Error(err.error || 'No se pudo guardar el producto.');
        }

        status.textContent = 'Producto guardado correctamente.';
        status.className = 'status success';
        form.reset();
      } catch (error) {
        status.textContent = error.message;
        status.className = 'status error';
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
